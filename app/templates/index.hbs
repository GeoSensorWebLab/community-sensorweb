<div id="container">
  {{#leaflet-map id="map-view" lat=lat lng=lng zoom=zoom as |layers|}}
    {{layers.tile url="https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"}}

    {{#each model as |thing|}}
      {{#if thing.lastLocation.location}}
      {{#layers.geoJSON geoJSON=thing.lastLocation.location onClick=(action "selectStation" thing) as |marker|}}
        {{#marker.popup}}
          {{thing.name}}
        {{/marker.popup}}
      {{/layers.geoJSON}}
      {{/if}}

    {{/each}}

  {{/leaflet-map}}

  <div id="chart-view">
    {{#unless activeStation}}
    <div class="waiting">
      <h2>Select a station for weather chart</h2>
    </div>
    {{else}}
    {{highchart-diagram id="chart" datastream=activeDatastream}}
    {{/unless}}
  </div>

  <div id="meta-view">
    {{#unless activeStation}}
    <div class="waiting">
      <h2>Select a station for metadata</h2>
    </div>
    {{else}}
    <div class="metadata">
      <h2>{{activeStation.name}}</h2>
      <p>{{activeStation.description}}</p>
      <h3><a href="{{forecastLinkForStation}}">2 Day Forecast</a></h3>
    </div>
    {{/unless}}
  </div>

  <div id="live-view">
    {{#unless activeStation}}
    <div class="waiting">
      <h2>Select a station for weather information</h2>
    </div>

    {{else}}

    <div class="update-time">
      <!-- TODO: This should point to the most recently updated datastream that we are extracting for this list -->
      <h3>Last Update:<br>{{activeStation.datastreams.firstObject.lastObservation.resultTime}}</h3>
    </div>

    {{live-panel name="temperature" datastream=activeStation.airTemperature activeDatastream=activeDatastream}}

    <div class="panel panel-wind">
      <h2>8 Kts NNW</h2>
    </div>

    <div class="panel panel-pressure">
      <h2>101.33 kPa</h2>
    </div>

    <div class="panel panel-visibility">
      <h2>64 km</h2>
    </div>

    <div class="panel panel-humidity">
      <h2>44 %</h2>
    </div>
    {{/unless}}
  </div>
</div>
